var Index=function(){var csrf_token=$('meta[name="csrf_token"]').attr("content"),table;const nameOfModule="assign-sample-product";var handleDataTable=function(){table=$("#tbl-"+nameOfModule).DataTable({responsive:!0,autoWidth:!0,dom:"Bfrtip",buttons:["pageLength"],searching:!0,paging:!0,lengthMenu:[[15,25,50],[15,25,50]],language:{info:"Show _START_ - _END_ from _TOTAL_ data",infoEmpty:"Show 0 - 0 from 0 data",infoFiltered:"",zeroRecords:"Data not found",loadingRecords:"Loading...",processing:"Processing..."},columnsDefs:[{searchable:!1,target:[0,1]},{orderable:!1,target:0}],processing:!0,serverSide:!0,ajax:{url:url+"/pic/sample-request/sample-product-information",type:"POST",data:{_token:csrf_token,sampleID:sampleID}},columns:[{data:"rnum",orderable:!1},{data:"product",orderable:!1},{data:"qty",orderable:!1},{data:"label",orderable:!1},{data:"action",orderable:!1}],drawCallback:function(settings){const recordUnsignSampleProduct=settings.json.sampleUnSign;0!==recordUnsignSampleProduct||"false"===recordUnsignSampleProduct?$("#btn-send-assign-email").attr("disabled","disabled"):($("#btn-send-assign-email").removeAttr("disabled"),handleSendAssignToEmail(sampleID))}}),$("#btnRefresh").click((function(e){e.preventDefault(),table.ajax.reload()})),getAssignValue(),getAssignInformation(),getEditAssign()},handleproductDropdown=function(){$("#user").select2({allowClear:!0,placeholder:"Select user for assign this sample product",dataType:"json",ajax:{method:"POST",url:url+"/pic/sample-request/assign",data:function(params){return{_token:csrf_token,search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,{results:data.items,pagination:{more:!0}}}},templateResult:format,templateSelection:formatSelection})},handleEditUserAssign=function(){$("#user-edit").select2({allowClear:!0,placeholder:"Select user for assign this sample product",dataType:"json",ajax:{method:"POST",url:url+"/pic/sample-request/assign",data:function(params){return{_token:csrf_token,search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,{results:data.items,pagination:{more:!0}}}},templateResult:format,templateSelection:formatSelection})},getAssignValue=function(){$(document).on("click",".btn-assign",(function(){const assignValue=$(this).data("assg");handleSendAssignForm(assignValue)}))},getAssignInformation=function(){$(document).on("click",".btn-info-assign",(function(){const assignValue=$(this).data("assg");$.ajax({url:`${url}/pic/sample-request/info-assign-sample-product`,type:"POST",data:{_token:csrf_token,av:assignValue},success:function(responses){var dataResponse=responses.data;$("#user-info").val(dataResponse.user),$("#email-info").val(dataResponse.email)},error:function(response){toastr.error("something went wrong, please try again")}})}))},getEditAssign=function(){$(document).on("click",".btn-edit-assign",(function(){const assignValue=$(this).data("assg");$.ajax({url:`${url}/pic/sample-request/edit-assign-sample-product`,type:"POST",data:{_token:csrf_token,av:assignValue},success:function(responses){var dataResponse=responses.data,selectId=dataResponse.id,selectText=dataResponse.text,found=!1;if($("#user-edit option").each((function(){if($(this).val()==selectId)return $(this).prop("selected",!0),found=!0,!1})),!found){var newOption=new Option(selectText,selectId,!0,!0);$("#user-edit").append(newOption).trigger("change")}handleEditUserAssign(),handleUpdateAssignForm(assignValue)},error:function(response){toastr.error("something went wrong, please try again")}})}))},handleSendAssignForm=function(assignValue){$("#form-"+nameOfModule).submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);formData.append("as",assignValue),confirm("Are you sure?")&&$.ajax({url:`${url}/pic/sample-request/send-assign-sample-product`,type:"POST",data:formData,processData:!1,contentType:!1,success:function(responses){toastr.success(responses.message),setTimeout(()=>{$("#modal-"+nameOfModule).modal("toggle"),$("#form-"+nameOfModule).trigger("reset"),$("#user").val(null).empty().trigger("change"),table.ajax.reload()},2500)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleUpdateAssignForm=function(assignValue){$("#form-edit-"+nameOfModule).submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);formData.append("as",assignValue),confirm("Are you sure?")&&$.ajax({url:`${url}/pic/sample-request/assign-sample-product/update`,type:"POST",data:formData,processData:!1,contentType:!1,success:function(responses){toastr.success(responses.message),setTimeout(()=>{window.location.reload()},2500)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleSendAssignToEmail=function(as){$("#form-asign-sample").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);formData.append("as",as),confirm("Are you sure?")&&$.ajax({url:`${url}/pic/sample-request/send-assign`,type:"POST",data:formData,processData:!1,contentType:!1,success:function(responses){toastr.success(responses.message),setTimeout(()=>{window.location.href=responses.url},2500)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))};function format(repo){if(repo.loading)return repo.text;var $container=$("<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'></div></div>");return $container.find(".select2-result-repository__title").text(repo.text),$container}function formatSelection(repo){return repo.text}return{init:function(){handleproductDropdown(),handleDataTable()}}}();$(document).ready((function(){Index.init()}));