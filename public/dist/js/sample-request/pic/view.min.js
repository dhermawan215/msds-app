var Index=function(){var csrf_token=$('meta[name="csrf_token"]').attr("content"),table,aSelected=[];const nameOfModule="sample-pic";var handleDataTable=function(){table=$("#tbl-sample-pic").DataTable({responsive:!0,autoWidth:!0,dom:"Bfrtip",buttons:["pageLength","csv","excel","pdf","print"],searching:!0,paging:!0,lengthMenu:[[15,25,50],[15,25,50]],language:{info:"Show _START_ - _END_ from _TOTAL_ data",infoEmpty:"Show 0 - 0 from 0 data",infoFiltered:"",zeroRecords:"Data not found",loadingRecords:"Loading...",processing:"Processing..."},columnsDefs:[{searchable:!1,target:[0,1]},{orderable:!1,target:0}],processing:!0,serverSide:!0,ajax:{url:url+"/pic/sample-request/list",type:"POST",data:function(d){d._token=csrf_token,d.sample_status=$("#status-sample").val()}},columns:[{data:"rnum",orderable:!1},{data:"id",orderable:!1},{data:"subject",orderable:!1},{data:"request",orderable:!1},{data:"delivery",orderable:!1},{data:"delivery_by",orderable:!1},{data:"pic",orderable:!1},{data:"creator",orderable:!1},{data:"cs",orderable:!1},{data:"status",orderable:!1},{data:"action",orderable:!1}],drawCallback:function(settings){}}),$("#tbl-sample-pic tbody").on("click","tr",(function(){handleAssign(table.row(this).data())})),$("#btnRefresh").click((function(e){e.preventDefault(),table.ajax.reload()})),$("#btn-reload").click((function(e){e.preventDefault(),window.location.reload()})),$("#status-sample").change((function(e){e.preventDefault(),table.ajax.reload()}))},handleAssign=function(param){$(document).on("click",".btn-assign",(function(){$("#sample-id").val(param.id);var as=$(this).data("as");handleAssignForm(as)}))},handleAssignForm=function(as){$("#form-asign-sample").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);formData.append("as",as),confirm("Are you sure?")&&$.ajax({url:`${url}/pic/sample-request/send-assign`,type:"POST",data:formData,processData:!1,contentType:!1,success:function(responses){toastr.success(responses.message),setTimeout(()=>{$("#modal-assign-sample").modal("toggle"),$("#form-assign-sample").trigger("reset"),$("#assign-to").val(null).empty().trigger("change"),table.ajax.reload()},2500)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleAssignUser=function(){$("#assign-to").select2({allowClear:!0,placeholder:"Select user/type user for assign sample",dataType:"json",ajax:{method:"POST",url:url+"/pic/sample-request/assign",data:function(params){return{_token:csrf_token,search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,{results:data.items,pagination:{more:!0}}}},templateResult:format,templateSelection:formatSelection})};function format(repo){if(repo.loading)return repo.text;var $container=$("<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'></div></div>");return $container.find(".select2-result-repository__title").text(repo.text),$container}function formatSelection(repo){return repo.text}var handleOpenTransaction=function(){$(document).on("click",".btn-open-tr",(function(e){e.preventDefault();const transactionValue=$(this).data("tr");confirm("Are you sure open this sample?")&&$.ajax({url:`${url}/pic/sample-request/open-transaction`,type:"POST",data:{_token:csrf_token,tr:transactionValue},success:function(responses){toastr.success(responses.message),setTimeout(()=>{table.ajax.reload()},2e3)},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))},handleDeliveryInformation=function(){$(document).on("click",".btn-delivery",(function(e){e.preventDefault();const deliveryValue=$(this).data("dl");$.ajax({url:`${url}/pic/sample-request/delivery-information`,type:"POST",data:{_token:csrf_token,dl:deliveryValue},success:function(responses){var dataResponse=responses.data;$("#delivery-name").val(dataResponse.delivery_name),$("#receipt").val(dataResponse.receipt)},error:function(response){}})}))};return{init:function(){handleDataTable(),handleAssignUser(),handleOpenTransaction(),handleDeliveryInformation()}}}();$(document).ready((function(){Index.init()}));