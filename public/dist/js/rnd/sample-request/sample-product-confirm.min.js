var Index=function(){var csrf_token=$('meta[name="csrf_token"]').attr("content"),table;const nameOfModule="confirm-sample-product";var handleDataTable=function(){table=$("#tbl-"+nameOfModule).DataTable({responsive:!0,autoWidth:!0,dom:"Bfrtip",buttons:["pageLength"],searching:!0,paging:!0,lengthMenu:[[15,25,50],[15,25,50]],language:{info:"Show _START_ - _END_ from _TOTAL_ data",infoEmpty:"Show 0 - 0 from 0 data",infoFiltered:"",zeroRecords:"Data not found",loadingRecords:"Loading...",processing:"Processing..."},columnsDefs:[{searchable:!1,target:[0,1]},{orderable:!1,target:0}],processing:!0,serverSide:!0,ajax:{url:url+"/rnd/sample-request/confirm/product-list",type:"POST",data:{_token:csrf_token,sampleID:sampleID}},columns:[{data:"rnum",orderable:!1},{data:"product",orderable:!1},{data:"qty",orderable:!1},{data:"label",orderable:!1},{data:"creator",orderable:!1},{data:"action",orderable:!1}],drawCallback:function(settings){}}),$("#btnRefresh").click((function(e){e.preventDefault(),table.ajax.reload()})),handleFinished()},handleGhs=function(){$("#ghs").select2({allowClear:!0,placeholder:"Select ghs/type ghs name",dataType:"json",ajax:{method:"POST",url:url+"/rnd/sample-request/confirm/ghs-list",data:function(params){return{_token:csrf_token,search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,{results:data.items,pagination:{more:!0}}}},templateResult:formatOption,templateSelection:formatSelection,multiple:!0}),$("#ghs").on("change",(function(){updatePreview()}))};function formatOption(option){return option.id?$('<span><img src="'+option.path+'" style="width: 30px; height: 30px; margin-right: 10px;" /> '+option.text+"</span>"):option.text}function formatSelection(option){return option.id?(updatePreview(),option.text):option.text}function updatePreview(){var selectedOptions=$("#ghs").select2("data");$("#ghs-preview").empty(),selectedOptions.forEach((function(item){$("#ghs-preview").append('<img src="'+item.path+'" alt="'+item.text+'"/>')})),0===selectedOptions.length&&$("#ghs-preview").empty()}var handleBatchNumberLab=function(){$("#batch-type").change((function(e){e.preventDefault();const batchTypeVal=$(this).val();"LAB"===batchTypeVal?($("#batch-number").attr("readonly",!0),requestBatchNumber()):($("#batch-number").removeAttr("readonly"),$("#batch-number").val(""))}))},requestBatchNumber=function(){$.ajax({type:"post",url:url+"/rnd/sample-request/batch-number",data:{_token:csrf_token},dataType:"json",success:function(response){$("#batch-number").val(response.data)},error:function(response){toastr.error("error")}})},handleOpenFormandSubmit=function(){$(document).on("click",".btn-add-batch",(function(){const sampleVal=$(this).data("sr"),productVal=$(this).data("pr"),sampleReProdVal=$(this).data("srp");console.log(sampleReProdVal,sampleVal,productVal),$("#form-add-sample-detail").submit((function(e){e.preventDefault();const form=$(this);let formData=new FormData(form[0]);formData.append("srVal",sampleVal),formData.append("prVal",productVal),formData.append("srpVal",sampleReProdVal),confirm("Are you sure?")&&$.ajax({url:`${url}/rnd/sample-request/confirm/create-sample-detail`,type:"POST",data:formData,processData:!1,contentType:!1,success:function(responses){toastr.success(responses.message),location.reload()},error:function(response){$.each(response.responseJSON,(function(key,value){toastr.error(value)}))}})}))}))},handleFinished=function(){$(document).on("click",".btn-finished",(function(){const sampleReProdid=$(this).data("srp");confirm("Are you sure finish the process?")&&$.ajax({type:"POST",url:url+"/rnd/sample-request/confirm/finished",data:{_token:csrf_token,srp:sampleReProdid},dataType:"json",success:function(response){toastr.success(response.message),setTimeout(()=>{location.reload()},2e3)},error:function(response){toastr.error(response.message)}})}))};return{init:function(){handleDataTable(),handleGhs(),handleBatchNumberLab(),handleOpenFormandSubmit()}}}();$(document).ready((function(){Index.init()}));